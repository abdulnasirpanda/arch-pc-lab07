     1                                  %include 'in_out.asm'
     1                              <1> ; in_out.asm
     2                              <1> ; Assembly library for input/output operations
     3                              <1> 
     4                              <1> section .text
     5                              <1> 
     6                              <1> ; -------------------------------------------
     7                              <1> ; String length calculation
     8                              <1> ; eax = pointer to string
     9                              <1> ; returns: eax = length
    10                              <1> ; -------------------------------------------
    11                              <1> slen:
    12 00000000 53                  <1>     push    ebx
    13 00000001 89C3                <1>     mov     ebx, eax
    14                              <1> 
    15                              <1> .next:
    16 00000003 803800              <1>     cmp     byte [eax], 0
    17 00000006 7403                <1>     jz      .finished
    18 00000008 40                  <1>     inc     eax
    19 00000009 EBF8                <1>     jmp     .next
    20                              <1> 
    21                              <1> .finished:
    22 0000000B 29D8                <1>     sub     eax, ebx
    23 0000000D 5B                  <1>     pop     ebx
    24 0000000E C3                  <1>     ret
    25                              <1> 
    26                              <1> ; -------------------------------------------
    27                              <1> ; String print
    28                              <1> ; eax = pointer to string
    29                              <1> ; -------------------------------------------
    30                              <1> sprint:
    31 0000000F 52                  <1>     push    edx
    32 00000010 51                  <1>     push    ecx
    33 00000011 53                  <1>     push    ebx
    34 00000012 50                  <1>     push    eax
    35 00000013 E8E8FFFFFF          <1>     call    slen
    36                              <1> 
    37 00000018 89C2                <1>     mov     edx, eax
    38 0000001A 58                  <1>     pop     eax
    39                              <1> 
    40 0000001B 89C1                <1>     mov     ecx, eax
    41 0000001D BB01000000          <1>     mov     ebx, 1
    42 00000022 B804000000          <1>     mov     eax, 4
    43 00000027 CD80                <1>     int     80h
    44                              <1> 
    45 00000029 5B                  <1>     pop     ebx
    46 0000002A 59                  <1>     pop     ecx
    47 0000002B 5A                  <1>     pop     edx
    48 0000002C C3                  <1>     ret
    49                              <1> 
    50                              <1> ; -------------------------------------------
    51                              <1> ; String print with line feed
    52                              <1> ; eax = pointer to string
    53                              <1> ; -------------------------------------------
    54                              <1> sprintLF:
    55 0000002D E8DDFFFFFF          <1>     call    sprint
    56                              <1> 
    57 00000032 50                  <1>     push    eax
    58 00000033 B80A000000          <1>     mov     eax, 0Ah
    59 00000038 50                  <1>     push    eax
    60 00000039 89E0                <1>     mov     eax, esp
    61 0000003B E8CFFFFFFF          <1>     call    sprint
    62 00000040 58                  <1>     pop     eax
    63 00000041 58                  <1>     pop     eax
    64 00000042 C3                  <1>     ret
    65                              <1> 
    66                              <1> ; -------------------------------------------
    67                              <1> ; String input
    68                              <1> ; ecx = buffer, edx = buffer length
    69                              <1> ; -------------------------------------------
    70                              <1> sread:
    71 00000043 50                  <1>     push    eax
    72 00000044 53                  <1>     push    ebx
    73 00000045 B803000000          <1>     mov     eax, 3
    74 0000004A BB00000000          <1>     mov     ebx, 0
    75 0000004F CD80                <1>     int     80h
    76 00000051 5B                  <1>     pop     ebx
    77 00000052 58                  <1>     pop     eax
    78 00000053 C3                  <1>     ret
    79                              <1> 
    80                              <1> ; -------------------------------------------
    81                              <1> ; Integer print (positive)
    82                              <1> ; eax = number to print
    83                              <1> ; -------------------------------------------
    84                              <1> iprint:
    85 00000054 50                  <1>     push    eax
    86 00000055 51                  <1>     push    ecx
    87 00000056 52                  <1>     push    edx
    88 00000057 56                  <1>     push    esi
    89 00000058 B900000000          <1>     mov     ecx, 0
    90                              <1> 
    91                              <1> .divide:
    92 0000005D 41                  <1>     inc     ecx
    93 0000005E BA00000000          <1>     mov     edx, 0
    94 00000063 BE0A000000          <1>     mov     esi, 10
    95 00000068 F7FE                <1>     idiv    esi
    96 0000006A 83C230              <1>     add     edx, 48
    97 0000006D 52                  <1>     push    edx
    98 0000006E 83F800              <1>     cmp     eax, 0
    99 00000071 75EA                <1>     jnz     .divide
   100                              <1> 
   101                              <1> .print:
   102 00000073 49                  <1>     dec     ecx
   103 00000074 89E0                <1>     mov     eax, esp
   104 00000076 E894FFFFFF          <1>     call    sprint
   105 0000007B 58                  <1>     pop     eax
   106 0000007C 83F900              <1>     cmp     ecx, 0
   107 0000007F 75F2                <1>     jnz     .print
   108                              <1> 
   109 00000081 5E                  <1>     pop     esi
   110 00000082 5A                  <1>     pop     edx
   111 00000083 59                  <1>     pop     ecx
   112 00000084 58                  <1>     pop     eax
   113 00000085 C3                  <1>     ret
   114                              <1> 
   115                              <1> ; -------------------------------------------
   116                              <1> ; Integer print with line feed
   117                              <1> ; eax = number to print
   118                              <1> ; -------------------------------------------
   119                              <1> iprintLF:
   120 00000086 E8C9FFFFFF          <1>     call    iprint
   121                              <1> 
   122 0000008B 50                  <1>     push    eax
   123 0000008C B80A000000          <1>     mov     eax, 0Ah
   124 00000091 50                  <1>     push    eax
   125 00000092 89E0                <1>     mov     eax, esp
   126 00000094 E876FFFFFF          <1>     call    sprint
   127 00000099 58                  <1>     pop     eax
   128 0000009A 58                  <1>     pop     eax
   129 0000009B C3                  <1>     ret
   130                              <1> 
   131                              <1> ; -------------------------------------------
   132                              <1> ; ASCII to integer conversion
   133                              <1> ; eax = pointer to string
   134                              <1> ; returns: eax = number
   135                              <1> ; -------------------------------------------
   136                              <1> atoi:
   137 0000009C 53                  <1>     push    ebx
   138 0000009D 51                  <1>     push    ecx
   139 0000009E 52                  <1>     push    edx
   140 0000009F 56                  <1>     push    esi
   141 000000A0 89C6                <1>     mov     esi, eax
   142 000000A2 B800000000          <1>     mov     eax, 0
   143 000000A7 B900000000          <1>     mov     ecx, 0
   144                              <1> 
   145                              <1> .multiply:
   146 000000AC 31DB                <1>     xor     ebx, ebx
   147 000000AE 8A1C0E              <1>     mov     bl, [esi+ecx]
   148 000000B1 80FB30              <1>     cmp     bl, 48
   149 000000B4 7C14                <1>     jl      .finished
   150 000000B6 80FB39              <1>     cmp     bl, 57
   151 000000B9 7F0F                <1>     jg      .finished
   152                              <1> 
   153 000000BB 80EB30              <1>     sub     bl, 48
   154 000000BE 01D8                <1>     add     eax, ebx
   155 000000C0 BB0A000000          <1>     mov     ebx, 10
   156 000000C5 F7E3                <1>     mul     ebx
   157 000000C7 41                  <1>     inc     ecx
   158 000000C8 EBE2                <1>     jmp     .multiply
   159                              <1> 
   160                              <1> .finished:
   161 000000CA BB0A000000          <1>     mov     ebx, 10
   162 000000CF F7F3                <1>     div     ebx
   163 000000D1 5E                  <1>     pop     esi
   164 000000D2 5A                  <1>     pop     edx
   165 000000D3 59                  <1>     pop     ecx
   166 000000D4 5B                  <1>     pop     ebx
   167 000000D5 C3                  <1>     ret
   168                              <1> 
   169                              <1> ; -------------------------------------------
   170                              <1> ; Exit program
   171                              <1> ; -------------------------------------------
   172                              <1> quit:
   173 000000D6 BB00000000          <1>     mov     ebx, 0
   174 000000DB B801000000          <1>     mov     eax, 1
   175 000000E0 CD80                <1>     int     80h
   176 000000E2 C3                  <1>     ret
     2                                  section .data
     3 00000000 D092D0B2D0B5D0B4D0-     msg1 db 'Введите B: ',0h
     3 00000009 B8D182D0B520423A20-
     3 00000012 00                 
     4 00000013 D09DD0B0D0B8D0B1D0-     msg2 db "Наибольшее число: ",0h
     4 0000001C BED0BBD18CD188D0B5-
     4 00000025 D0B520D187D0B8D181-
     4 0000002E D0BBD0BE3A2000     
     5 00000035 14000000                A dd 20
     6 00000039 32000000                C dd 50
     7                                  section .bss
     8 00000000 <res Ah>                max resb 10
     9 0000000A <res Ah>                B resb 10
    10                                  
    11                                  section .text
    12                                  global _start
    13                                  _start:
    14                                      ; --- Вывод сообщения 'Введите B: '
    15 000000E3 B8[00000000]                mov eax, msg1
    16 000000E8 E822FFFFFF                  call sprint
    17                                      
    18                                      ; --- Ввод 'B'
    19 000000ED B9[0A000000]                mov ecx, B
    20 000000F2 BA0A000000                  mov edx, 10
    21 000000F7 E847FFFFFF                  call sread
    22                                      
    23                                      ; --- Преобразование 'B' из символа в число
    24 000000FC B8[0A000000]                mov eax, B
    25 00000101 E896FFFFFF                  call atoi
    26 00000106 A3[0A000000]                mov [B], eax
    27                                      
    28                                      ; --- Записываем 'A' в переменную 'max'
    29 0000010B 8B0D[35000000]              mov ecx, [A]
    30 00000111 890D[00000000]              mov [max], ecx
    31                                      
    32                                      ; --- Сравниваем 'A' и 'C'
    33 00000117 3B0D[39000000]              cmp ecx, [C]
    34 0000011D 7F0C                        jg check_B
    35 0000011F 8B0D[39000000]              mov ecx, [C]
    36 00000125 890D[00000000]              mov [max], ecx
    37                                      
    38                                  check_B:
    39                                      ; --- Сравниваем 'max(A,C)' и 'B'
    40 0000012B 8B0D[00000000]              mov ecx, [max]
    41 00000131 3B0D[0A000000]              cmp ecx, [B]
    42 00000137 7F0C                        jg fin
    43 00000139 8B0D[0A000000]              mov ecx, [B]
    44 0000013F 890D[00000000]              mov [max], ecx
    45                                      
    46                                  fin:
    47 00000145 B8[13000000]                mov eax, msg2
    48 0000014A E8C0FEFFFF                  call sprint
    49 0000014F A1[00000000]                mov eax, [max]
    50 00000154 E82DFFFFFF                  call iprintLF
    51 00000159 E878FFFFFF                  call quit
